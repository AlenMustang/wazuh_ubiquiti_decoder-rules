<group name="unifi_rules">

  <rule id="100100" level="0">
    <decoded_as>unifi-cef</decoded_as>
    <description>UniFi CEF event (grouping).</description>
  </rule>

  <rule id="100101" level="3">
    <if_sid>100100</if_sid>
    <field name="unifi_event_name">Admin Accessed UniFi Network</field>
    <description>UniFi: Admin $(unifi_admin) accessed the network via $(unifi_access_method) from $(srcip).</description>
    <group>authentication_success,unifi,syslog,nis2_article_21_2_h</group>
    <mitre>
      <id>T1078</id>
    </mitre>
  </rule>
<rule id="100102" level="5">
    <if_sid>100100</if_sid>
    <field name="unifi_event_name">Admin Made Config Changes</field>
    <description>UniFi: Admin $(unifi_admin) made configuration changes.</description>
    <group>configuration_change,unifi,syslog,nis2_article_21_2_e</group>
    <mitre>
      <id>T1562</id>
    </mitre>
  </rule>

  <rule id="100103" level="3">
    <if_sid>100100</if_sid>
    <field name="unifi_event_name">Device Adopted</field>
    <description>UniFi: Device $(unifi_device_name) adopted.</description>
    <group>unifi,syslog,nis2_article_21_2_e</group>
    <mitre>
      <id>T1200</id>
    </mitre>
  </rule>
  
  <rule id="100104" level="5">
    <if_sid>100100</if_sid>
    <field name="unifi_event_name">Device Offline</field>
    <description>UniFi: Device $(unifi_device_name) went offline.</description>
    <group>unifi,syslog,availability,nis2_article_21_2_c</group>
    <mitre>
      <id>T1489</id>
    </mitre>
  </rule>

  <rule id="100105" level="2">
    <if_sid>100100</if_sid>
    <field name="unifi_event_name">WiFi Client Connected</field>
    <description>UniFi: WiFi client $(unifi_client_mac) connected.</description>
    <group>unifi,syslog</group>
  </rule>
  
  <rule id="100106" level="2">
    <if_sid>100100</if_sid>
    <field name="unifi_event_name">WiFi Client Disconnected</field>
    <description>UniFi: WiFi client $(unifi_client_mac) disconnected.</description>
    <group>unifi,syslog</group>
  </rule>

  <rule id="100107" level="2">
    <if_sid>100100</if_sid>
    <field name="unifi_event_name">Client Connected</field>
    <description>UniFi: Client $(unifi_client_mac) connected.</description>
    <group>unifi,syslog</group>
  </rule>
  
  <rule id="100108" level="2">
    <if_sid>100100</if_sid>
    <field name="unifi_event_name">Client Disconnected</field>
    <description>UniFi: Client $(unifi_client_mac) disconnected.</description>
    <group>unifi,syslog</group>
  </rule>

  <rule id="100117" level="2">
    <if_sid>100100</if_sid>
    <field name="unifi_event_name">WiFi Client Roaming</field>
    <description>UniFi: WiFi client $(unifi_client_mac) roaming.</description>
    <group>unifi,syslog</group>
  </rule>

<rule id="100109" level="8">
    <if_sid>100100</if_sid>
    <field name="unifi_event_name">Threat Detected</field>
    <description>UniFi: Security threat detected and blocked from $(srcip). Message: $(msg)</description>
    <group>unifi,security,syslog,ids,nis2_article_21_2_b</group>
    <mitre>
      <id>T1071</id>
    </mitre>
  </rule>
  
 <rule id="100110" level="8">
    <if_sid>100100</if_sid>
    <field name="unifi_event_name">Honeypot Triggered</field>
    <description>UniFi: Honeypot triggered by $(srcip).</description>
    <group>unifi,security,syslog,nis2_article_21_2_b</group>
    <mitre>
      <id>T1046</id>
    </mitre>
  </rule>

  <rule id="100111" level="5">
    <if_sid>100100</if_sid>
    <field name="unifi_event_name">Blocked by Firewall</field>
    <description>UniFi: Traffic blocked by firewall from $(srcip).</description>
    <group>unifi,firewall,syslog,nis2_article_21_2_a</group>
    <mitre>
      <id>T1071</id>
    </mitre>
  </rule>

<rule id="100112" level="5">
    <if_sid>100100</if_sid>
    <field name="unifi_event_name">WAN Failover</field>
    <description>UniFi: WAN failover event to $(unifi_failover_wan_name).</description>
    <group>unifi,syslog,availability,nis2_article_21_2_c</group>
    <mitre>
      <id>T1489</id>
    </mitre>
  </rule>

  <rule id="100113" level="4">
    <if_sid>100100</if_sid>
    <field name="unifi_event_name">High Latency Detected</field>
    <description>UniFi: High latency detected on interface $(deviceOutboundInterface).</description>
    <group>unifi,syslog,performance,nis2_article_21_2_c</group>
  </rule>
 
 <rule id="100114" level="4">
    <if_sid>100100</if_sid>
    <field name="unifi_event_name">Packet Loss Detected</field>
    <description>UniFi: Packet loss detected on interface $(deviceOutboundInterface).</description>
    <group>unifi,syslog,performance,nis2_article_21_2_c</group>
  </rule>

  <rule id="100115" level="6">
    <if_sid>100100</if_sid>
    <field name="unifi_event_name">Insufficient PoE</field>
    <description>UniFi: Insufficient PoE output on $(unifi_device_name).</description>
    <group>unifi,syslog,power,nis2_article_21_2_c</group>
  </rule>
  
  <rule id="100116" level="5">
    <if_sid>100100</if_sid>
    <field name="unifi_event_name">AP Underpowered</field>
    <description>UniFi: Access point $(unifi_device_name) underpowered.</description>
    <group>unifi,syslog,power,nis2_article_21_2_c</group>
  </rule>

  <rule id="100118" level="5">
    <if_sid>100100</if_sid>
    <field name="unifi_event_name">PoE Availability Exceeded</field>
    <description>UniFi: PoE availability exceeded on switch $(unifi_device_name).</description>
    <group>unifi,syslog,power,nis2_article_21_2_c</group>
  </rule>


  <rule id="100201" level="2">
    <if_sid>100100</if_sid>
    <match>disassociated</match>
    <description>UniFi device: WiFi client disassociated.</description>
    <group>unifi,syslog</group>
  </rule>
  
  <rule id="100202" level="2">
    <if_sid>100100</if_sid>
    <match>associated</match>
    <description>UniFi device: WiFi client associated.</description>
    <group>unifi,syslog</group>
  </rule>
 
 <rule id="100203" level="2">
    <if_sid>100100</if_sid>
    <match>authenticated</match>
    <description>UniFi device: WiFi client authenticated.</description>
    <group>unifi,syslog</group>
  </rule>
  
  <rule id="100204" level="3">
    <if_sid>100100</if_sid>
    <match>RADIUS</match>
    <description>UniFi device: RADIUS event.</description>
    <group>unifi,syslog,authentication,nis2_article_21_2_h</group>
  </rule>
  
  <rule id="100210" level="10" frequency="5" timeframe="60">
    <if_matched_sid>100204</if_matched_sid>
    <description>UniFi: Multiple RADIUS events in 60 seconds (possible brute-force).</description>
    <group>unifi,security,authentication_failures,nis2_article_21_2_b</group>
    <mitre>
      <id>T1110</id>
    </mitre>
  </rule>
  
  <rule id="100211" level="8" frequency="10" timeframe="60">
    <if_matched_sid>100201</if_matched_sid>
    <description>UniFi: Rapid WiFi disassociations in 60 seconds (possible deauth attack or flapping).</description>
    <group>unifi,security,nis2_article_21_2_b</group>
    <mitre>
      <id>T1498</id>
    </mitre>
  </rule>
 
 <rule id="100212" level="8" frequency="20" timeframe="120">
    <if_matched_sid>100111</if_matched_sid>
    <same_source_ip />
    <description>UniFi: Repeated firewall blocks from same source $(srcip) in 120 seconds.</description>
    <group>unifi,security,firewall,nis2_article_21_2_b</group>
    <mitre>
      <id>T1046</id>
    </mitre>
  </rule>
 
 <rule id="100213" level="12" frequency="10" timeframe="120">
    <if_matched_sid>100109</if_matched_sid>
    <description>UniFi: Multiple security threats detected in 120 seconds.</description>
    <group>unifi,security,nis2_article_21_2_b</group>
    <mitre>
      <id>T1071</id>
    </mitre>
  </rule>
  
  <rule id="100215" level="10" frequency="20" timeframe="300">
    <if_matched_sid>100111</if_matched_sid>
    <same_source_ip />
    <description>UniFi (aggressive): Repeated firewall blocks from same source $(srcip) in 5 minutes.</description>
    <group>unifi,security,firewall,aggressive,nis2_article_21_2_b</group>
    <mitre>
      <id>T1046</id>
    </mitre>
  </rule>
  
  <rule id="100216" level="10" frequency="15" timeframe="300">
    <if_matched_sid>100204</if_matched_sid>
    <same_source_ip />
    <description>UniFi (aggressive): Repeated RADIUS activity from same source $(srcip) in 5 minutes.</description>
    <group>unifi,security,authentication_failures,aggressive,nis2_article_21_2_b</group>
    <mitre>
      <id>T1110</id>
    </mitre>
  </rule>
  <rule id="100218" level="14" frequency="10" timeframe="600">
    <if_matched_sid>100109</if_matched_sid>
    <same_source_ip />
    <description>UniFi (aggressive): Source $(srcip) triggering multiple threats in 10 minutes.</description>
    <group>unifi,security,aggressive,nis2_article_21_2_b</group>
    <mitre>
      <id>T1046</id>
    </mitre>
  </rule>
</group>
